<html>
    <head>
        <title>Wireless Keypad</title>
        <meta name="viewport" content="width=device-width">
	<!--
        <link rel="stylesheet" type="text/css" href="/static/css/remote.css">
        <link rel="stylesheet" type="text/css" href="/static/fonts/Pelli/PelliFont.css">
        <link rel="stylesheet" type="text/css" href="/static/fonts/Sloan/SloanFont.css">
	-->
        <script src="https://unpkg.com/peerjs@1.3.1/dist/peerjs.min.js" type="text/javascript"></script>
        <script src="./keypad.js" type="text/javascript"></script>


        <!-- 
        Client (ie mobile device) webapp for communicating text responses
        to another device, namely a personal computer running a PsychoPy/JS 
        experiment.
        Accepts URL parameters:
        - alphabet: the domain of symbols with which the user may respond 
        - font: the font that should be used, if available 
        - peerID: peerID of the experiment/client application
        -->

    </head>

    <body>
        <h2 id="remote-header" class="noselect"></h2>

        <main>
            <div id="remote-control"></div>
        </main>
    </body>

    <script>
        import { v4 as uuidv4 } from 'uuid';
        import Peer from 'peerjs';

        window.onload = () => {
            // Establish ID for this, the keypad client
            const meID = uuidv4();
            const peer = new Peer(meID);

            // Parse parameters
            const params = new URLSearchParams(window.location.search);

            // TODO how do I make sure this is being cached? need more performant
            var pressFeedback = new Audio('/static/sound/buttonPressFeedback.mp3');

            // Get start time for remote
            let startTime = Date.now();

            remoteControl.style.setProperty('--nbuttons', cleanAlphabet.length);

            // Generate keypad for user inside establishPeerConnection
            establishPeerConnection(peer, meID, params);
        };
    </script>
</html>
